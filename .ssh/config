# Last modified by robo config.ssh on 2023-02-11T22:19:20 MST
# segment-robo-ssh-config: REMOTE_LOGNAME=ty.alexander

Host workbench-prod workbench-prod-usw2
  User ty.alexander
  ProxyCommand ssm-workbench prod

Host workbench-stage workbench-stage-usw2
  User ty.alexander
  ProxyCommand ssm-workbench stage

Host workbench-stage-euw1
  User ty.alexander
  # requires segment-aws-okta >= 0.7.3
  ProxyCommand ssm-workbench stage-euw1

Host workbench-prod-euw1
  User ty.alexander
  # requires segment-aws-okta >= 0.7.3
  ProxyCommand ssm-workbench prod-euw1

# Note the below 2 are for specific accounts customer-datalakes-stage and customer-datalakes-prod
# Do not remove them in favor of the match and tokens pattern below or it will try to search
# For the workbench hosts in stage / prod accounts
Host workbench-customer-datalakes-prod
  User ty.alexander
  ProxyCommand ssm-workbench customer-datalakes-prod

Host workbench-customer-datalakes-stage
  User ty.alexander
  ProxyCommand ssm-workbench customer-datalakes-stage

Match Host workbench-*-stage,workbench-*-stage-*,workbench-*-prod,workbench-*-prod-*
  User ty.alexander

Host workbench-*-stage workbench-*-prod
  ## workbench-foo-bar-stage => stage foo-bar
  ProxyCommand sh -c "ssm-workbench $(echo '%h' | sed 's/^workbench-\(.*\)-\(.*\)$/\2 \1/')"

Host workbench-*-stage-* workbench-*-prod-*
  ## workbench-foo-bar-stage-euw1 => stage-euw1 foo-bar
  ProxyCommand sh -c "ssm-workbench $(echo '%h' | sed 's/^workbench-\(.*\)-\([^-]*\)-\([^-]*\)$/\2-\3 \1/')"

# This is an edge case for the onebox team
Host workbench-onebox
  User ty.alexander
  ProxyCommand ssm-workbench prod onebox

# Adding this in case of rollbacks
Host old-workbench-prod
  User ty.alexander
  ProxyCommand ssh -W $(aws-okta exec production -- aws ec2 describe-instances --filters Name=tag:Cluster,Values=workbench Name=tag:Team,Values=$SEGMENT_TEAM Name=instance-state-name,Values=running Name=tag-key,Values=aws:autoscaling:groupName --query 'Reservations[0].Instances[0].PrivateIpAddress' --output text):%p %r@bastion-v2.segment.com

# Adding this in case of rollbacks
Host old-workbench-stage
  User ty.alexander
  ProxyCommand ssh -W $(aws-okta exec stage -- aws ec2 describe-instances --filters Name=tag:Cluster,Values=workbench Name=tag:Team,Values=$SEGMENT_TEAM Name=instance-state-name,Values=running Name=tag-key,Values=aws:autoscaling:groupName --query 'Reservations[0].Instances[0].PrivateIpAddress' --output text):%p %r@bastion-v2.segment.build

Host 10.10.*
  User ty.alexander
  ProxyCommand ssm-ssh-port-forward dev %h

Host 10.30.* 10.31.* 10.32.*
  User ty.alexander
  ProxyCommand ssm-ssh-port-forward stage %h

Host 10.37.*
  User ty.alexander
  ProxyCommand ssm-ssh-port-forward stage-euw1 %h

Host 10.50.* 10.51.* 10.52.* 10.53.* 10.54.*
  User ty.alexander
  ProxyCommand ssm-ssh-port-forward prod %h

Host 10.80.* 10.81.* 10.82.* 10.83.* 10.84.*
  User ty.alexander
  ProxyCommand ssm-ssh-port-forward prod-euw1 %h

Host prod.i-*
  User ty.alexander
  ProxyCommand ssm-ssh-instance-id prod %h

Host prod-euw1.i-*
  User ty.alexander
  ProxyCommand ssm-ssh-instance-id prod-euw1 %h

Host stage.i-*
  User ty.alexander
  ProxyCommand ssm-ssh-instance-id stage %h

Host stage-euw1.i-*
  User ty.alexander
  ProxyCommand ssm-ssh-instance-id stage-euw1 %h

Host dataeng-prod.i-*
  User ty.alexander
  ProxyCommand ssm-ssh-instance-id bizops %h

Host dataeng-stage.i-*
  User ty.alexander
  ProxyCommand ssm-ssh-instance-id engbiz %h

Host datalakes-prod.i-*
  User ty.alexander
  ProxyCommand ssm-ssh-instance-id customer-datalakes-prod %h

Host datalakes-stage.i-*
  User ty.alexander
  ProxyCommand ssm-ssh-instance-id customer-datalakes-stage %h

Host 10.* workbench-* datalakes* dataeng* stage* prod*
  SendEnv AWS_*
  ForwardAgent yes
  ServerAliveInterval 30

Host github.com
  ControlMaster no
  Hostname ssh.github.com
  Port 443
  User git

Host *
  ControlMaster auto
  ControlPersist 3600
  ControlPath /tmp/ssh-control-master-%C

Include config.tynet
